!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("__lucchetto__",[],e):"object"==typeof exports?exports.__lucchetto__=e():t.__lucchetto__=e()}(self,(function(){return(()=>{var t={993:function(t,e,s){const r=/,metadata=([^,]*)/,a=["@rs.overhide.io"],o=["@test.rs.overhide.io","@localhost:8000"];class i{constructor(t,e=!1,s=null){this.remoteStorage=t,this.metadata={},this.previousToken=null,this.currentUserAddress=null,this.isTest=e,this.hub=s,this.lastImparterToken=null,document.addEventListener("DOMContentLoaded",this.onDomLoad)}onDomLoad=()=>{this.extendWidget(),this.initHub(),this.remoteStorage.on("connected",this.onConnected)};onConnected=()=>{this.metadata={};const t=this.remoteStorage.remote.token;t&&(this.metadata=this._getMetadata(t),this.rewriteUsername(),this.instrumentHub())};_getMetadata=t=>{let e={};if(!t)return e;const s=t.match(r);return s&&(e=JSON.parse(atob(s[1]))),e};rewriteUsername=()=>{if(!this.remoteStorage.remote.userAddress)return;const t=this.remoteStorage.remote.userAddress.split("@")[0],e=this.remoteStorage.remote.userAddress.split("@")[1];"p2ma_address"in this.metadata&&t!==this.metadata.p2ma_address&&this.previousToken!==this.remoteStorage.remote.token&&(console.log(`lucchetto: rewriting username ${t} => ${this.metadata.p2ma_address}`),this.previousToken=this.remoteStorage.remote.token,this.currentUserAddress=`${this.metadata.p2ma_address}@${e}`,this.remoteStorage.connect(this.currentUserAddress,this.remoteStorage.remote.token))};initHub=()=>{this.hub?this.isTest?this.hub.setAttribute("apiKey","0x9a6aef977a293b5c49ac5fcdd6376010e027549b8aa0ff97bc65a1d8649aef62"):this.hub.setAttribute("apiKey","0xc16f6e6d8666fdd835d909422fc141dfe5efcbcca3125bf746ef63019c486e47"):console.warn("no pay2my.app hub configured for lucchetto therefore no IAPs")};instrumentHub=()=>{const t=JSON.stringify(this.metadata);this.hub&&"p2ma_address"in this.metadata&&this.lastImparterToken!==t&&(console.log("lucchetto: instrumenting hub"),this.hub.setCurrentImparterChecked(this.metadata.p2ma_imparter,this.metadata.p2ma_token,this.metadata.p2ma_signature,this.metadata.p2ma_address),this.lastImparterToken=t)};extendWidget=()=>{this.attempt=0,this._extendWidget()};_extendWidget=()=>{const t=document.querySelector("input[name='rs-user-address']"),e=this.isTest?o:a;if(this.attempt++,!(this.attempt>20))if(t)try{t.setAttribute("placeholder",e[0]),t.setAttribute("list","rs-user-address-list");const s=document.createElement("datalist");s.setAttribute("id","rs-user-address-list");for(const t of e){const e=document.createElement("option");e.setAttribute("value",t),s.appendChild(e)}t.after(s)}catch{}else setTimeout(this.extendWidget,250)};getMetadata=()=>this.metadata;getUserAddress=()=>this.currentUserAddress&&this.currentUserAddress===this.remoteStorage.remote.userAddress?this.currentUserAddress:null;getNamespace=()=>"pay2my.app";getPath=(t,e,s)=>{if(!e||!e.match(/^\d{0,7}(\.\d{2})?$/))throw'"price" must be in dollars, optionally with a period and cents, e.g. `2.00`';if(!s||!s.match(/^\d{1,8}$/))throw'"within" must be a whole number, e.g. `525600`';if(!t||!t.match(/^[0-9a-z.-]{2,20}$/))throw'"SKU" must be a a string comprised of 2 to 20 numbers, lower case letters, hypens, and periods, e.g. `item`';if((e=(+e).toFixed(2))<.5)throw'"price" must be > "0.50"';return`/${t}/${e}/${s}`};getSku=async(t,e)=>{const s=await fetch(`${t}/pay2myapp?sku=${e.sku}&priceDollars=${(+e.priceDollars).toFixed(2)}&withinMinutes=${e.withinMinutes}&currency=${e.currency}&from=${e.from}&to=${e.to}&isTest=${e.isTest}&asOf=${e.asOf}&message=${btoa(e.message)}&signature=${btoa(e.signature)}`);if(s.ok)return(await s.json()).data;throw`error talking to back-end &mdash; ${s.status} &mdash; ${s.statusText}`}}("object"==typeof self&&self.self===self&&self||"object"==typeof s.g&&s.g.global===s.g&&s.g||this||{}).Lucchetto=i,t.exports={Lucchetto:i}}},e={};function s(r){var a=e[r];if(void 0!==a)return a.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,s),o.exports}return s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s(993)})()}));