!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("__lucchetto__",[],e):"object"==typeof exports?exports.__lucchetto__=e():t.__lucchetto__=e()}(self,(function(){return(()=>{var t={993:function(t,e,s){const r=/,metadata=([^,]*)/,o=["@rs.overhide.io"],i=["@test.rs.overhide.io","@localhost:8000"];class a{constructor(t,e=!1){this.remoteStorage=t,this.metadata={},this.previousToken=null,this.currentUserAddress=null,this.isTest=e,document.addEventListener("DOMContentLoaded",this.onDomLoad)}onDomLoad=()=>{this.extendWidget(),this.remoteStorage.on("connected",this.onConnected)};onConnected=()=>{this.metadata={};const t=this.remoteStorage.remote.token;t&&(this.metadata=this._getMetadata(t),this.rewriteUsername())};_getMetadata=t=>{let e={};if(!t)return e;const s=t.match(r);return s&&(e=JSON.parse(atob(s[1]))),e};rewriteUsername=()=>{if(!this.remoteStorage.remote.userAddress)return;const t=this.remoteStorage.remote.userAddress.split("@")[0],e=this.remoteStorage.remote.userAddress.split("@")[1];"p2ma_address"in this.metadata&&t!==this.metadata.p2ma_address&&this.previousToken!==this.remoteStorage.remote.token&&(console.log(`lucchetto: rewriting username ${t} => ${this.metadata.p2ma_address}`),this.previousToken=this.remoteStorage.remote.token,this.currentUserAddress=`${this.metadata.p2ma_address}@${e}`,this.remoteStorage.connect(this.currentUserAddress,this.remoteStorage.remote.token))};extendWidget=()=>{this.attempt=0,this._extendWidget()};_extendWidget=()=>{const t=document.querySelector("input[name='rs-user-address']"),e=this.isTest?i:o;if(this.attempt++,!(this.attempt>20))if(t)try{t.setAttribute("placeholder",e[0]),t.setAttribute("list","rs-user-address-list");const s=document.createElement("datalist");s.setAttribute("id","rs-user-address-list");for(const t of e){const e=document.createElement("option");e.setAttribute("value",t),s.appendChild(e)}t.after(s)}catch{}else setTimeout(this.extendWidget,250)};getMetadata=()=>this.metadata;getUserAddress=()=>this.currentUserAddress?this.currentUserAddress:this.remoteStorage.remote.userAddress}("object"==typeof self&&self.self===self&&self||"object"==typeof s.g&&s.g.global===s.g&&s.g||this||{}).Lucchetto=a,t.exports={Lucchetto:a}}},e={};function s(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,s),i.exports}return s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s(993)})()}));