!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("__lucchetto__",[],t):"object"==typeof exports?exports.__lucchetto__=t():e.__lucchetto__=t()}(self,(function(){return(()=>{var e={993:function(e,t,r){const o=/,metadata=([^,]*)/;class s{constructor(e){this.remoteStorage=e,this.metadata={},this.previousToken=null,this.currentUserAddress=null,document.addEventListener("DOMContentLoaded",this.onDomLoad)}onDomLoad=()=>{this.remoteStorage.on("connected",this.onConnected)};onConnected=()=>{this.metadata={};const e=this.remoteStorage.remote.token;e&&(this.metadata=this._getMetadata(e),this.rewriteUsername())};_getMetadata=e=>{let t={};if(!e)return t;const r=e.match(o);return r&&(t=JSON.parse(atob(r[1]))),t};rewriteUsername=()=>{if(!this.remoteStorage.remote.userAddress)return;const e=this.remoteStorage.remote.userAddress.split("@")[0],t=this.remoteStorage.remote.userAddress.split("@")[1];"p2ma_address"in this.metadata&&e!==this.metadata.p2ma_address&&this.previousToken!==this.remoteStorage.remote.token&&(console.log(`lucchetto: rewriting username ${e} => ${this.metadata.p2ma_address}`),this.previousToken=this.remoteStorage.remote.token,this.currentUserAddress=`${this.metadata.p2ma_address}@${t}`,this.remoteStorage.connect(this.currentUserAddress,this.remoteStorage.remote.token))};getMetadata=()=>this.metadata;getUserAddress=()=>this.currentUserAddress?this.currentUserAddress:this.remoteStorage.remote.userAddress}("object"==typeof self&&self.self===self&&self||"object"==typeof r.g&&r.g.global===r.g&&r.g||this||{}).Lucchetto=s,e.exports={Lucchetto:s}}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(993)})()}));